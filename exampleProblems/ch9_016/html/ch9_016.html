<!DOCTYPE html>
<html lang="en">
<head>

<style>
    .tooltip {
        position: absolute;
        background-color: #fff;
        border: 1px solid #ddd;
        padding: 8px;
        border-radius: 5px;
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        pointer-events: none;
        display: inline-block;
        max-width: 480px; /* Set max-width for the tooltip */
    }

    /* Style for the SVG border */
    svg {
        border: 1px solid black; /* 1px solid black border */
    }
    .center {
        display: block;
        margin-left: auto;
        margin-right: auto;
    }
    </style>

<style>
    .container {
        text-align: center;
    }
    .color-container {
        position: relative;
        display: inline-block;
        margin-right: 20px;
    }

    .color-box {
        width: 100px;
        height: 50px;
    }

    .striped-rectangle {
        width: 100px;
        height: 50px;
        background: repeating-linear-gradient(90deg, #ccc, #ccc 10px, #fff 10px, #fff 20px);
    }

    .color-text {
        position: absolute;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        color: black; /* Adjust text color as needed */
    }

    .orange { background-color: #FFA500; }
    .green { background-color: #98FB98; }
    .yellow { background-color: yellow; }
    .cyan { background-color: #00FFFF; }
    .grey { background-color: #808080; }
    .blue { background-color: #ADD8E6; }
</style>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ch9_016</title>
  <script src="https://d3js.org/d3.v6.min.js"></script>
</head>
<body>

     <!-- SVG container with background molecule image -->

    <?xml version='1.0' encoding='iso-8859-1'?>
<svg class="center" version='1.1' baseProfile='full'
              xmlns='http://www.w3.org/2000/svg'
                      xmlns:rdkit='http://www.rdkit.org/xml'
                      xmlns:xlink='http://www.w3.org/1999/xlink'
                  xml:space='preserve'
width=1200 height=700 viewBox='0 0 1200 700'>
<!-- END OF HEADER -->
<g transform='translate(100, 50)'>
<rect style='opacity:1.0;fill:none;stroke:none' width='1000' height='600' x='0' y='0'> </rect>
<path class='bond-0' d='M 655.403,492.024 L 651.49,416.033' style='fill:none;fill-rule:evenodd;stroke:#0000FF;stroke-width:2.0px;stroke-linecap:butt;stroke-linejoin:miter;stroke-opacity:1' />
<path class='bond-0' d='M 651.49,416.033 L 647.578,340.041' style='fill:none;fill-rule:evenodd;stroke:#000000;stroke-width:2.0px;stroke-linecap:butt;stroke-linejoin:miter;stroke-opacity:1' />
<path class='bond-1' d='M 647.578,340.041 L 495.614,262.434' style='fill:none;fill-rule:evenodd;stroke:#000000;stroke-width:2.0px;stroke-linecap:butt;stroke-linejoin:miter;stroke-opacity:1' />
<path class='bond-6' d='M 647.578,340.041 L 790.77,247.24' style='fill:none;fill-rule:evenodd;stroke:#000000;stroke-width:2.0px;stroke-linecap:butt;stroke-linejoin:miter;stroke-opacity:1' />
<path class='bond-2' d='M 495.614,262.434 L 352.422,355.236' style='fill:none;fill-rule:evenodd;stroke:#000000;stroke-width:2.0px;stroke-linecap:butt;stroke-linejoin:miter;stroke-opacity:1' />
<path class='bond-3' d='M 352.422,355.236 L 200.457,277.629' style='fill:none;fill-rule:evenodd;stroke:#000000;stroke-width:2.0px;stroke-linecap:butt;stroke-linejoin:miter;stroke-opacity:1' />
<path class='bond-4' d='M 191.177,263.31 L 128.214,304.116' style='fill:none;fill-rule:evenodd;stroke:#000000;stroke-width:2.0px;stroke-linecap:butt;stroke-linejoin:miter;stroke-opacity:1' />
<path class='bond-4' d='M 128.214,304.116 L 65.2506,344.922' style='fill:none;fill-rule:evenodd;stroke:#FF0000;stroke-width:2.0px;stroke-linecap:butt;stroke-linejoin:miter;stroke-opacity:1' />
<path class='bond-4' d='M 209.737,291.949 L 146.774,332.754' style='fill:none;fill-rule:evenodd;stroke:#000000;stroke-width:2.0px;stroke-linecap:butt;stroke-linejoin:miter;stroke-opacity:1' />
<path class='bond-4' d='M 146.774,332.754 L 83.811,373.56' style='fill:none;fill-rule:evenodd;stroke:#FF0000;stroke-width:2.0px;stroke-linecap:butt;stroke-linejoin:miter;stroke-opacity:1' />
<path class='bond-5' d='M 200.457,277.629 L 196.56,201.938' style='fill:none;fill-rule:evenodd;stroke:#000000;stroke-width:2.0px;stroke-linecap:butt;stroke-linejoin:miter;stroke-opacity:1' />
<path class='bond-5' d='M 196.56,201.938 L 192.664,126.246' style='fill:none;fill-rule:evenodd;stroke:#FF0000;stroke-width:2.0px;stroke-linecap:butt;stroke-linejoin:miter;stroke-opacity:1' />
<path class='bond-7' d='M 783.01,262.436 L 850.359,296.831' style='fill:none;fill-rule:evenodd;stroke:#000000;stroke-width:2.0px;stroke-linecap:butt;stroke-linejoin:miter;stroke-opacity:1' />
<path class='bond-7' d='M 850.359,296.831 L 917.708,331.226' style='fill:none;fill-rule:evenodd;stroke:#FF0000;stroke-width:2.0px;stroke-linecap:butt;stroke-linejoin:miter;stroke-opacity:1' />
<path class='bond-7' d='M 798.531,232.043 L 865.88,266.438' style='fill:none;fill-rule:evenodd;stroke:#000000;stroke-width:2.0px;stroke-linecap:butt;stroke-linejoin:miter;stroke-opacity:1' />
<path class='bond-7' d='M 865.88,266.438 L 933.23,300.833' style='fill:none;fill-rule:evenodd;stroke:#FF0000;stroke-width:2.0px;stroke-linecap:butt;stroke-linejoin:miter;stroke-opacity:1' />
<path class='bond-8' d='M 790.77,247.24 L 786.874,171.548' style='fill:none;fill-rule:evenodd;stroke:#000000;stroke-width:2.0px;stroke-linecap:butt;stroke-linejoin:miter;stroke-opacity:1' />
<path class='bond-8' d='M 786.874,171.548 L 782.977,95.8567' style='fill:none;fill-rule:evenodd;stroke:#FF0000;stroke-width:2.0px;stroke-linecap:butt;stroke-linejoin:miter;stroke-opacity:1' />
<path  class='atom-0' d='M 650.091 496.29
L 659.371 511.29
Q 660.291 512.77, 661.771 515.45
Q 663.251 518.13, 663.331 518.29
L 663.331 496.29
L 667.091 496.29
L 667.091 524.61
L 663.211 524.61
L 653.251 508.21
Q 652.091 506.29, 650.851 504.09
Q 649.651 501.89, 649.291 501.21
L 649.291 524.61
L 645.611 524.61
L 645.611 496.29
L 650.091 496.29
' fill='#0000FF'/>
<path  class='atom-0' d='M 670.491 496.29
L 674.331 496.29
L 674.331 508.33
L 688.811 508.33
L 688.811 496.29
L 692.651 496.29
L 692.651 524.61
L 688.811 524.61
L 688.811 511.53
L 674.331 511.53
L 674.331 524.61
L 670.491 524.61
L 670.491 496.29
' fill='#0000FF'/>
<path  class='atom-0' d='M 694.024 523.617
Q 694.71 521.848, 696.347 520.871
Q 697.984 519.868, 700.254 519.868
Q 703.079 519.868, 704.663 521.399
Q 706.247 522.93, 706.247 525.649
Q 706.247 528.421, 704.188 531.009
Q 702.155 533.596, 697.931 536.658
L 706.564 536.658
L 706.564 538.77
L 693.971 538.77
L 693.971 537.001
Q 697.456 534.52, 699.515 532.672
Q 701.601 530.824, 702.604 529.161
Q 703.607 527.497, 703.607 525.781
Q 703.607 523.986, 702.71 522.983
Q 701.812 521.98, 700.254 521.98
Q 698.75 521.98, 697.746 522.587
Q 696.743 523.194, 696.03 524.541
L 694.024 523.617
' fill='#0000FF'/>
<path  class='atom-5' d='M 44.2649 370.511
Q 44.2649 363.711, 47.6249 359.911
Q 50.9849 356.111, 57.2649 356.111
Q 63.5449 356.111, 66.9049 359.911
Q 70.2649 363.711, 70.2649 370.511
Q 70.2649 377.391, 66.8649 381.311
Q 63.4649 385.191, 57.2649 385.191
Q 51.0249 385.191, 47.6249 381.311
Q 44.2649 377.431, 44.2649 370.511
M 57.2649 381.991
Q 61.5849 381.991, 63.9049 379.111
Q 66.2649 376.191, 66.2649 370.511
Q 66.2649 364.951, 63.9049 362.151
Q 61.5849 359.311, 57.2649 359.311
Q 52.9449 359.311, 50.5849 362.111
Q 48.2649 364.911, 48.2649 370.511
Q 48.2649 376.231, 50.5849 379.111
Q 52.9449 381.991, 57.2649 381.991
' fill='#FF0000'/>
<path  class='atom-6' d='M 178.684 107.301
Q 178.684 100.501, 182.044 96.7005
Q 185.404 92.9005, 191.684 92.9005
Q 197.964 92.9005, 201.324 96.7005
Q 204.684 100.501, 204.684 107.301
Q 204.684 114.181, 201.284 118.101
Q 197.884 121.981, 191.684 121.981
Q 185.444 121.981, 182.044 118.101
Q 178.684 114.221, 178.684 107.301
M 191.684 118.781
Q 196.004 118.781, 198.324 115.901
Q 200.684 112.981, 200.684 107.301
Q 200.684 101.741, 198.324 98.9405
Q 196.004 96.1005, 191.684 96.1005
Q 187.364 96.1005, 185.004 98.9005
Q 182.684 101.701, 182.684 107.301
Q 182.684 113.021, 185.004 115.901
Q 187.364 118.781, 191.684 118.781
' fill='#FF0000'/>
<path  class='atom-6' d='M 208.084 93.2205
L 211.924 93.2205
L 211.924 105.261
L 226.404 105.261
L 226.404 93.2205
L 230.244 93.2205
L 230.244 121.541
L 226.404 121.541
L 226.404 108.461
L 211.924 108.461
L 211.924 121.541
L 208.084 121.541
L 208.084 93.2205
' fill='#FF0000'/>
<path  class='atom-8' d='M 929.735 324.927
Q 929.735 318.127, 933.095 314.327
Q 936.455 310.527, 942.735 310.527
Q 949.015 310.527, 952.375 314.327
Q 955.735 318.127, 955.735 324.927
Q 955.735 331.807, 952.335 335.727
Q 948.935 339.607, 942.735 339.607
Q 936.495 339.607, 933.095 335.727
Q 929.735 331.847, 929.735 324.927
M 942.735 336.407
Q 947.055 336.407, 949.375 333.527
Q 951.735 330.607, 951.735 324.927
Q 951.735 319.367, 949.375 316.567
Q 947.055 313.727, 942.735 313.727
Q 938.415 313.727, 936.055 316.527
Q 933.735 319.327, 933.735 324.927
Q 933.735 330.647, 936.055 333.527
Q 938.415 336.407, 942.735 336.407
' fill='#FF0000'/>
<path  class='atom-9' d='M 768.998 76.9108
Q 768.998 70.1108, 772.358 66.3108
Q 775.718 62.5108, 781.998 62.5108
Q 788.278 62.5108, 791.638 66.3108
Q 794.998 70.1108, 794.998 76.9108
Q 794.998 83.7908, 791.598 87.7108
Q 788.198 91.5908, 781.998 91.5908
Q 775.758 91.5908, 772.358 87.7108
Q 768.998 83.8308, 768.998 76.9108
M 781.998 88.3908
Q 786.318 88.3908, 788.638 85.5108
Q 790.998 82.5908, 790.998 76.9108
Q 790.998 71.3508, 788.638 68.5508
Q 786.318 65.7108, 781.998 65.7108
Q 777.678 65.7108, 775.318 68.5108
Q 772.998 71.3108, 772.998 76.9108
Q 772.998 82.6308, 775.318 85.5108
Q 777.678 88.3908, 781.998 88.3908
' fill='#FF0000'/>
<path  class='atom-9' d='M 798.398 62.8308
L 802.238 62.8308
L 802.238 74.8708
L 816.718 74.8708
L 816.718 62.8308
L 820.558 62.8308
L 820.558 91.1508
L 816.718 91.1508
L 816.718 78.0708
L 802.238 78.0708
L 802.238 91.1508
L 798.398 91.1508
L 798.398 62.8308
' fill='#FF0000'/>
<path  d='M 656.351,510.45 L 647.578,340.041' class='bond-selector bond-0' style='fill:#fff;stroke:#fff;stroke-width:4px;fill-opacity:0;stroke-opacity:0' />
<path  d='M 647.578,340.041 L 495.614,262.434' class='bond-selector bond-1' style='fill:#fff;stroke:#fff;stroke-width:4px;fill-opacity:0;stroke-opacity:0' />
<path  d='M 495.614,262.434 L 352.422,355.236' class='bond-selector bond-2' style='fill:#fff;stroke:#fff;stroke-width:4px;fill-opacity:0;stroke-opacity:0' />
<path  d='M 352.422,355.236 L 200.457,277.629' class='bond-selector bond-3' style='fill:#fff;stroke:#fff;stroke-width:4px;fill-opacity:0;stroke-opacity:0' />
<path  d='M 200.457,277.629 L 57.2649,370.431' class='bond-selector bond-4' style='fill:#fff;stroke:#fff;stroke-width:4px;fill-opacity:0;stroke-opacity:0' />
<path  d='M 200.457,277.629 L 191.684,107.221' class='bond-selector bond-5' style='fill:#fff;stroke:#fff;stroke-width:4px;fill-opacity:0;stroke-opacity:0' />
<path  d='M 647.578,340.041 L 790.77,247.24' class='bond-selector bond-6' style='fill:#fff;stroke:#fff;stroke-width:4px;fill-opacity:0;stroke-opacity:0' />
<path  d='M 790.77,247.24 L 942.735,324.847' class='bond-selector bond-7' style='fill:#fff;stroke:#fff;stroke-width:4px;fill-opacity:0;stroke-opacity:0' />
<path  d='M 790.77,247.24 L 781.998,76.8308' class='bond-selector bond-8' style='fill:#fff;stroke:#fff;stroke-width:4px;fill-opacity:0;stroke-opacity:0' />
<circle  cx='656.351' cy='510.45' r='22.7513' class='atom-selector atom-0' style='fill:#fff;stroke:#fff;stroke-width:1px;fill-opacity:0;stroke-opacity:0' />
<circle  cx='647.578' cy='340.041' r='22.7513' class='atom-selector atom-1' style='fill:#fff;stroke:#fff;stroke-width:1px;fill-opacity:0;stroke-opacity:0' />
<circle  cx='495.614' cy='262.434' r='22.7513' class='atom-selector atom-2' style='fill:#fff;stroke:#fff;stroke-width:1px;fill-opacity:0;stroke-opacity:0' />
<circle  cx='352.422' cy='355.236' r='22.7513' class='atom-selector atom-3' style='fill:#fff;stroke:#fff;stroke-width:1px;fill-opacity:0;stroke-opacity:0' />
<circle  cx='200.457' cy='277.629' r='22.7513' class='atom-selector atom-4' style='fill:#fff;stroke:#fff;stroke-width:1px;fill-opacity:0;stroke-opacity:0' />
<circle  cx='57.2649' cy='370.431' r='22.7513' class='atom-selector atom-5' style='fill:#fff;stroke:#fff;stroke-width:1px;fill-opacity:0;stroke-opacity:0' />
<circle  cx='191.684' cy='107.221' r='22.7513' class='atom-selector atom-6' style='fill:#fff;stroke:#fff;stroke-width:1px;fill-opacity:0;stroke-opacity:0' />
<circle  cx='790.77' cy='247.24' r='22.7513' class='atom-selector atom-7' style='fill:#fff;stroke:#fff;stroke-width:1px;fill-opacity:0;stroke-opacity:0' />
<circle  cx='942.735' cy='324.847' r='22.7513' class='atom-selector atom-8' style='fill:#fff;stroke:#fff;stroke-width:1px;fill-opacity:0;stroke-opacity:0' />
<circle  cx='781.998' cy='76.8308' r='22.7513' class='atom-selector atom-9' style='fill:#fff;stroke:#fff;stroke-width:1px;fill-opacity:0;stroke-opacity:0' />
</g>
</svg>
 

    <!-- Tooltip for displaying node information -->
    <div id="tooltip" class="tooltip">Tooltip content</div>
    <br>
    <div class="container">
        <div class="color-container">
            <div class="color-box orange"></div>
            <div class="color-text">-C-</div>
        </div>
        <div class="color-container">
            <div class="color-box green"></div>
            <div class="color-text">-CH</div>
        </div>
        <div class="color-container">
            <div class="color-box yellow"></div>
            <div class="color-text">-CH<sub>2</sub></div>
        </div>
        <div class="color-container">
            <div class="color-box cyan"></div>
            <div class="color-text">-CH<sub>3</sub></div>
        </div>
        <div class="color-container">
            <div class="color-box grey"></div>
            <div class="color-text">HMBC</div>
        </div>
        <div class="color-container">
            <div class="color-box blue"></div>
            <div class="color-text">COSY</div>
        </div>
        <div class="color-container">
            <div class="striped-rectangle"></div>
            <div class="color-text">NOESY</div>
        </div>
    </div>
        
  <script>
    // Create the SVG container
    const svg = d3.select("svg");
    const width = +svg.attr("width");
    const height = +svg.attr("height");

    // Get the corresponding DOM element
    var svgNode = svg.node();
    // Get the dimensions of the SVG element
    var svgWidth = svgNode.clientWidth;
    var svgHeight = svgNode.clientHeight;

    // Define scale functions for x and y coordinates
    const xScale = d3.scaleLinear().domain([0, 1]).range([0, width-100*2]);
    const yScale = d3.scaleLinear().domain([0, 1]).range([0, height-50*2]);

    // // define colour blind friendly colours
    // const orange = '#FFA500';
    // const blue = '#ADD8E6';
    // const green = '#98FB98';
    // const yellow = '#FFFF00';
    // const purple = '#800080';
    // const cyan = '#00FFFF';
    // const grey = '#808080';
    // const black = '#000000';
    // const white = '#FFFFFF';

    // define colour blind friendly colours with 50% transparency
    const orange = 'rgba(255, 165, 0, 1)';
    const blue = 'rgba(173, 216, 230, 1)';
    const green = 'rgba(152, 251, 152, 1)';
    const yellow = 'rgba(255, 255, 0, 1)';
    const purple = 'rgba(128, 0, 128, 1)';
    const cyan = 'rgba(0, 255, 255, 1)';
    const grey = 'rgba(128, 128, 128, 1)';
    const black = 'rgba(0, 0, 0, 1)';
    const white = 'rgba(255, 255, 255, 1)';

    // Define color scale for nodes based on numProtons
    const colorScale = d3.scaleOrdinal()
      .domain([0, 1, 2, 3])
      .range([orange, green, yellow, cyan ]); // Blue, Orange, Green, Red

    // Define the graph data
    const nodes = [	{numProtons: 0, ppm: 184.1, x: 0.20045692272770302, y: 0.46271555855371765, H1_ppm: [], jCouplingClass: [], jCouplingVals: [], id: 1},
	{numProtons: 0, ppm: 177.4, x: 0.790770328379151, y: 0.41206606920380895, H1_ppm: [], jCouplingClass: [], jCouplingVals: [], id: 2},
	{numProtons: 1, ppm: 57.4, x: 0.647578351412862, y: 0.5667357763992479, H1_ppm: [3.75], jCouplingClass: ["dd"], jCouplingVals: ["6, 4"], id: 3},
	{numProtons: 2, ppm: 36.2, x: 0.35242164858713815, y: 0.5920605210742023, H1_ppm: [2.34], jCouplingClass: ["dt"], jCouplingVals: ["4, 6, 6"], id: 4},
	{numProtons: 2, ppm: 29.7, x: 0.4956136255534271, y: 0.4373908138787633, H1_ppm: [2.11, 2.06], jCouplingClass: ["dtd", "dtd"], jCouplingVals: ["2, 6, 6, 4", "2, 6, 6, 4"], id: 5},
];

    const links = [	{"hmbc": true, "source": 1, "target": 4},
	{"hmbc": true, "source": 1, "target": 5},
	{"hmbc": true, "source": 2, "target": 3},
	{"hmbc": true, "source": 2, "target": 5},
	{"cosy": true, "hmbc": true, "source": 3, "target": 5},
	{"hmbc": true, "source": 3, "target": 4},
	{"cosy": true, "hmbc": true, "source": 4, "target": 5},
];

    // Set initial positions of nodes and links
    nodes.forEach(node => {
        node.x = xScale(node.x)+100;
        node.y = yScale(node.y)+50;
    });

    // Filter links that have the attribute cosy as true
    const cosyLinks = links.filter(link => link.cosy);

    // Create the links
    const link = svg.selectAll(".link")
      .data(cosyLinks)
      .enter().append("line")
      .attr("class", "link")
      .attr("stroke", "black")
      .attr("x1", d => nodes[d.source-1].x)
      .attr("y1", d => nodes[d.source-1].y)
      .attr("x2", d => nodes[d.target-1].x)
      .attr("y2", d => nodes[d.target-1].y)
      .attr("stroke", blue) // Set the stroke color for links to blue
      .attr("stroke-width", 8); // Set the stroke width to 2 pixels

    // Create the nodes
    const node = svg.selectAll(".node")
      .data(nodes)
      .enter().append("g")
      .attr("class", "node")
      .attr("transform", d => `translate(${d.x},${d.y})`)
      .call(d3.drag()
        .on("start", dragstarted)
        .on("drag", dragged)
        .on("end", dragended));

    // Add circles to represent nodes
    node.append("circle")
      .attr("r", 22)
      .attr("fill", d => colorScale(d.numProtons)) // Set fill color based on numProtons
      .on("mouseover", (event, d) => handleMouseOver(event, d)) // Call function when mouseover
      .on("mouseout", (event, d) => handleMouseOut(event, d));  // Call function when mouseout

    // Append text
    node.append("text")
        .attr("class", "node-text")
        .text(d => d.id) // Display the id
        .attr("dy", -8) // Center the text vertically
        .attr("font-size", "12px") // Set font size to 16 pixels
        .attr("text-anchor", "middle"); // Center the text horizontally

    // // Append ppm text
    node.append("text")
        .attr("class", "node-text")
        .text(d => d.ppm.toFixed(2)) // Display the id
        .attr("dy", +8) // Center the text vertically
        .attr("font-size", "12px") // Set font size to 16 pixels
        .attr("text-anchor", "middle"); // Center the text horizontally

    // Tooltip for node hover
    const tooltip = d3.select("#tooltip");

    let hmbcLinks = []; // Track hmbc links separately
    var circlenodes = document.querySelectorAll('.node circle');
    var textnodes = document.querySelectorAll('.node text');
    console.log("length of textnodes: ", textnodes.length);
    console.log(textnodes[0])
    // print out the textnodes innerhtml text
    textnodes.forEach( t => {
        console.log(t.innerHTML);
    });

    // set the font colour to grey for all the text nodes
    textnodes.forEach( t => {
        t.style.fill = 'white';
    });

    // Drag handlers
    function dragstarted(event, d) {
      // Remove hmbc links
      hmbcLinks.forEach(link => link.remove());
      hmbcLinks = []; // Clear the hmbc links array
      d3.select(this).raise().classed("active", true);
    }

    function dragged(event, d) {
      d.x = event.x;
      d.y = event.y;
      d3.select(this).attr("transform", `translate(${d.x},${d.y})`);
      link.filter(l => l.source === d.id).attr("x1", d.x).attr("y1", d.y);
      link.filter(l => l.target === d.id).attr("x2", d.x).attr("y2", d.y);
    }

    function dragended(event, d) {
      d3.select(this).classed("active", false);
    }

    // // Function to find nearest neighbors of a node with a specific attribute
    // function findNearestNeighbors(nodeId, attribute) {
    // const neighbors = [];

    // // Iterate through the links
    // links.forEach(link => {
    //     if (link[attribute] && (link.source === nodeId || link.target === nodeId)) {
    //     neighbors.push(link.source === nodeId ? link.target : link.source);
    //     }
    // });

    // return neighbors;
    // }

    // Function to find nearest neighbors of a node with a specific attribute
    function findNearestNeighbors(nodeId, attribute) {
        const neighbors = [];
        const nonNeighbors = [];

        // Iterate through the links
        links.forEach(link => {
            if (link[attribute] && (link.source === nodeId || link.target === nodeId)) {
                neighbors.push(link.source === nodeId ? link.target : link.source);
            }
        });

        // Iterate through all nodes to find non-neighbors
        nodes.forEach(node => {
            if (node.id !== nodeId && !neighbors.includes(node.id)) {
                nonNeighbors.push(node.id);
            }
        });

        return { neighbors, nonNeighbors };
    }



    // Function to handle mouseover event
    function handleMouseOver(event, d) {
        // Display tooltip
        if (event) {

            // generate the html sub string for d.H1 ppm which is an array

            // When numProtons is 0
            if (d.numProtons == 0) {
                var htmlstr =  `C${d.id} ${generateHTMLnumProtonsString(d.numProtons)}: <sup>13</sup>C = ${d.ppm.toFixed(2)} ppm`;
            } else if (d.H1_ppm.length == 1) {
                // Expect d.H1 to be an array of length 1
                var htmlstr =  `C${d.id} ${generateHTMLnumProtonsString(d.numProtons)}: <sup>13</sup>C = ${d.ppm.toFixed(2)} ppm, <sup>1</sup>H = ${d.H1_ppm[0].toFixed(2)} ppm`;
                    htmlstr = htmlstr + `<br>J's : ${d.jCouplingClass[0]} : ${d.jCouplingVals[0]} Hz`;
            } else {
                // Expect d.H1 to be an array of length 2
                var htmlstr =  `C${d.id} ${generateHTMLnumProtonsString(d.numProtons)}: <sup>13</sup>C = ${d.ppm.toFixed(2)} ppm, <sup>1</sup>H = ${d.H1_ppm[0].toFixed(2)} & ${d.H1_ppm[1].toFixed(2)} ppm`;
                // add the J coupling values
                htmlstr = htmlstr + `<br>J's : ${d.jCouplingClass[0]} : ${d.jCouplingVals[0]} Hz, ${d.jCouplingClass[1]} : ${d.jCouplingVals[1]} Hz`;
            }

            tooltip.transition()
                .duration(200)
                .style("opacity", 0.9);
            tooltip.html(htmlstr)    
                .style("left", (200) + "px")
                .style("top", (-99999) + "px")
                .style("display", "inline-block");

            var tooltipDiv = d3.select('#tooltip');

            // Get the corresponding DOM element
            var tooltipNode = tooltipDiv.node();

            var pageWidth = document.documentElement.clientWidth;

            // Get the dimensions of the div element
            var tooltipWidth = tooltipNode.clientWidth;
            var tooltipHeight = tooltipNode.clientHeight;
            var tooltipX = (pageWidth - tooltipWidth) / 2;

            tooltip.html(htmlstr) 
                .style("left", (tooltipX) + "px")
                .style("top", (30) + "px")
                .style("display", "inline-block");
        }
        // Increase the radius
        d3.select(event.target)
            .transition()
            .duration(100)
            .attr("r", 26);

        // select all the nodes circles
        // var circlenodes = document.querySelectorAll('.node circle');
        // print out the circle ids
        // console.log("circlenodes", circlenodes);
        // // set the opacity of all the circles to 0.5
        // circlenodes.forEach( c => {
        //     c.style.opacity = 0.5;
        // });
        // circlenodes.forEach(function(nod) {
        //     console.log("node.id", node.id);
        // });

        // Define the attribute to find nearest neighbors
        const attribute = "hmbc";
        const attribute2 = "noesy";
        
        // Call the function to find nearest neighbors
        const hmbcNearestNodes = findNearestNeighbors(d.id, attribute);
        const noesyNearestNodes = findNearestNeighbors(d.id, attribute2);

        const nearestNeighborIDs = hmbcNearestNodes.neighbors;
        const nearestNeighborIDs2 = noesyNearestNodes.neighbors;

        console.log(hmbcNearestNodes.neighbors);
        console.log(hmbcNearestNodes.nonNeighbors);
        console.log(noesyNearestNodes.nonNeighbors);
        console.log(noesyNearestNodes.neighbors);

        // Reduce opacity for non-neighbors
        // hmbcNearestNodes.nonNeighbors.forEach(nonNeighborId => {
        //     const nonNeighborNode = node.find(node => node.id === nonNeighborId);
        //     // nonNeighborNode.style('opacity', 0.5); // Adjust opacity as needed
        //     if (nonNeighborNode) {
        //         d3.select(`#${nonNeighborId}`).style('opacity', 0.5);
        //     }
        // });
       
    // change the fill color of non-neighbors to grey
    hmbcNearestNodes.nonNeighbors.forEach(nonNeighborId => {
        // circlenodes[nonNeighborId-1].style.opacity = 0.75;   
        circlenodes[nonNeighborId-1].style.fill = 'lightgrey';
    });

    // increase the size of the circles for the nearest neighbors
    nearestNeighborIDs.forEach(neighborID => {
        circlenodes[neighborID-1].setAttribute("r", 26);
    });
   
    
       
        // Add hmbc links to nearest neighbors
        nearestNeighborIDs.forEach(neighborID => {
            const neighborNode = nodes.find(node => node.id === neighborID);
            if (neighborNode) {
                const link = svg.insert("line", ".node")
                    .attr("class", "link")
                    .attr("x1", d.x)
                    .attr("y1", d.y)
                    .attr("x2", neighborNode.x)
                    .attr("y2", neighborNode.y)
                    .attr("stroke", grey)
                    .attr("stroke-width", 7); // Set the stroke width to 2 pixels
                hmbcLinks.push(link); // Track the hmbc links
            }
        });

    nearestNeighborIDs2.forEach(neighborID => {
        const neighborNode = nodes.find(node => node.id === neighborID);
            if (neighborNode) {
                const path = d3.path();
                path.moveTo(d.x, d.y);
                path.quadraticCurveTo(0, 0, neighborNode.x, neighborNode.y);

                const link = svg.insert("path", ".node")
                    .attr("class", "link")
                    .attr("fill", "none")
                    .attr("stroke", grey)
                    .attr("stroke-width", 7) // Set the stroke width to 7 pixels
                    .attr("stroke-dasharray", "5,5") // Set the stroke-dasharray for dashed lines
                    .attr("d", path); // Generate the curved link path using cubic Bezier curve
                hmbcLinks.push(link); // Track the hmbc links
            }
    });
}

    // Function to handle mouseout event
    function handleMouseOut(event, d) {
        // set the opacity of all the circles to 1
        // var circlenodes = document.querySelectorAll('.node circle');
        // reset the fill color of all the circles to their original color
        // loop through the nodes to get the id and numProtons
        nodes.forEach(d => {
            circlenodes[d.id-1].style.fill = colorScale(d.numProtons);
            // reset the size of the circles
            circlenodes[d.id-1].setAttribute("r", 22);
        }
        );


        // Hide the tooltip
        tooltip.transition()
                .duration(100)
                .style("opacity", 0);
        // // Revert the radius
        // d3.select(event.target)
        //     .transition()
        //     .duration(100)
        //     .attr("r", 22);

        // Remove hmbc links
        hmbcLinks.forEach(link => link.remove());
        hmbcLinks = []; // Clear the hmbc links array
    }

    function generateHTMLnumProtonsString(index) {
        switch (index) {
            case 0:
            return "-C-";
            case 1:
            return "-CH";
            case 2:
            return "-CH<sub>2</sub>";
            case 3:
            return "-CH<sub>3</sub>";
            default:
            return "<p>Invalid index</p>";
        }
    }
  </script>
</body>
</html>